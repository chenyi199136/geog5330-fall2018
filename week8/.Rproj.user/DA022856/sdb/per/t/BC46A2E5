{
    "collab_server" : "",
    "contents" : "---\ntitle: \"Week 7 Homework: Writing a Kriging function\"\noutput: pdf_document\n---\n```{r global_options, echo=FALSE, results='asis'}\nknitr::opts_chunk$set(fig.width=12, fig.height=8, fig.path='Figs/',  warning=FALSE, message=FALSE)\nrm(list=ls())\n```\n\n**Note:** I used some equations in the description of this homework. To view them clearly, please click the 'knit' button on the top of this window. In case you have problem with the knitting, a pdf file is also enclosed ('homework.pdf') for you.\n\n\nThe following simple table contains measurements at $10$ locations $z(s_i),\ni = 1,\\dots 10$, and we need to make estimation of a target location\n($z(s_{11})$, red star point) using kriging. \n\n```{r hw, eval=T, echo=F}\n\n#oa<-readShapePoints('Data/oa.shp')\n#oa<-subset(oa, oa$WTE2013>0)\n#inc <- sample(1:nrow(oa), 10)\n#x <- oa@coords[inc,1]\n#y <- oa@coords[inc,2]\n#value <- oa$WTE2013[inc]\n#obs<-cbind(x,y,value)\n#rownames(obs)=1:10\n#write.csv(obs, 'data.csv', row.names=F)\n\nobs=read.csv('data.csv')\nxtarget=4540000\nytarget=20640000\nhead(obs)\nplot(obs$x,obs$y)\npoints(xtarget,ytarget, col='red', pch='*', cex=3)\n```\n\nAssume that we know the mean of the observations is $0$. As mentioned in\nthe class, simple kriging can be used to make this estimation. We have\nlearned that, with a specification of covariogram/variogram $\\gamma(h)$,\nthe kriging weights can be obtained by $\\omega=\\sum_{dd}^{-1}\\sigma_{dt}$,\nwhere the $\\omega$ is the vector of kriging weights, $\\sum_{dd}$ is the \ncovariance matrix of the observation specified by $\\gamma(h)$, and $\\sigma_{dt}$\nindicates the covariance vector between the targeted location and the\nobservations. The kriging estimation can then been given as \n$\\hat{z}(s_{11})=\\sum_{i=1}^{10}\\omega_{i}z(s_i)$ and the associated variance is\n$\\hat{\\sigma}(s_{11})=\\sigma(0) - \n\\sum_{i=1}^{10}\\omega_{i}\\sigma(|s_{11}-s_{i}|)$, where $\\sigma(0)$ is the\nvariance of the $z(s_i), i = 1, \\dots, 10$. With these, please finish the\nfollowing two questions.\n\n# Question 1\n\nThe exponential covariogram function $\\gamma(h)$ is given in the following\nR block.\n\n```{r hw2, eval=T, echo=T}\n\n# this is a function to return the value of exponential covariogram based on \n#the input distance. The covariogram parameters have been specified. \n\nexpVariogram<-function(distance){\n    nugget=0; sill=2000; range=20000\n    return (nugget+sill*exp(-3*distance/range))\n}\n```\n\nWith this covariogram, please finish the following `kriging(object, location)`\nfunction. The input of this function are sample locations and values\n(`object'), and the location ('location') to be estimated. The expected return\nvalue of this function is kriging estimation at `location`.\n\n```{r hw3, eval=T, echo=T}\n\n#With the above exponential covariogram, please finish the following kriging function\n\nkriging<-function(object, location){\n\tn=nrow(object)\n\tx <- as.matrix(cbind(object$x, object$y))\n\t# First, we calculate the distance matrix between observations. \n\t# Initialize distance matrix\n\tx1 <- rep(rep(0,n),n)         \n\tdist <- matrix(x1,nrow=n,ncol=n) \n\tfor (i in 1:n){ \n\t\tfor (j in 1:n){ \n\t\t\tdist[i,j]=sqrt((x[i,1]-x[j,1])^2+(x[i,2]-x[j,2])^2) \n\t\t} \n\t}\n\t#######################################################\n\t## Here, please add your code to convert the distance matrix to covariance\n\t## matrix (Hint: use the provided covariogram function *expVariogram()*)\n\n\n  ## \n\t######################################################\n\n\n\tdist2= rep(0,n) # initialize observation to target distance \n\tfor(i in 1:n){\n\t\tdist2[i]=sqrt((x[i,1]-location[1])^2+(x[i,2]-location[2])^2)\n\t}\n\n\t#######################################################\n\t## Here, please add your code to convert the distance vector between target\n\t# and observations to the vector of covariance (Hint: use the provided covariogram \n\t# function *expVariogram()*)\n\n        #\n\t#######################################################\n\n\t# The following code generate the kriging weighs for each observations. \n\t# function `solve(C)` to invert a matrix `C`, and function `%*%` to\n\t# multiply two matrix\n\n\tw <- solve(C) %*% c\n\n\t#######################################################\n\t# Here, according to the equation given previously in this document,\n\t# please add your code to get the kriging estimation (say it is called zhat) and the associated\n\t# variance based on the weight `w`\n\n\tzhat <- 0 # Initilized as 0\n\n  #\n\t#######################################################\n\n\treturn (zhat)\n}\n```\n\n# Question 2\n\nUsing the `kriging()` function you completed in previous question, please\nmake estimation at the $10$ observed locations and compare the difference\nbetween your estimation and the observations. What do you find from the\ndifference?\n\n\n\n",
    "created" : 1507697381343.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3228900231",
    "id" : "BC46A2E5",
    "lastKnownWriteTime" : 1507698245,
    "last_content_update" : 1507698245218,
    "path" : "~/Git/hub/geog5330-homework/week7/homework.Rmd",
    "project_path" : null,
    "properties" : {
        "marks" : "<:116,2\n>:119,-1"
    },
    "relative_order" : 3,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}